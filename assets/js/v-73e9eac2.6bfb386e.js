"use strict";(self.webpackChunkistr_wiki_vuepress=self.webpackChunkistr_wiki_vuepress||[]).push([[211],{926:(n,s,a)=>{a.r(s),a.d(s,{data:()=>p});const p={key:"v-73e9eac2",path:"/python/04module-ssh-ftp.html",title:"",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"paramiko模块",slug:"paramiko模块",children:[{level:3,title:"二、实现SFTP功能",slug:"二、实现sftp功能",children:[]},{level:3,title:"三、使用秘钥实现SSH功能",slug:"三、使用秘钥实现ssh功能",children:[]},{level:3,title:"四、使用秘钥实现SFTP功能",slug:"四、使用秘钥实现sftp功能",children:[]}]}],filePathRelative:"python/04module-ssh-ftp.md",git:{updatedTime:1625572353e3,contributors:[{name:"刘玉路",email:"lyl07583@ly.com",commits:2}]}}},476:(n,s,a)=>{a.r(s),a.d(s,{default:()=>t});const p=(0,a(6252).uE)('<h2 id="paramiko模块" tabindex="-1"><a class="header-anchor" href="#paramiko模块" aria-hidden="true">#</a> paramiko模块</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> paramiko\n\n<span class="token comment"># 创建SSH对象</span>\nssh <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SSHClient<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 允许连接不在known_hosts文件上的主机</span>\nssh<span class="token punctuation">.</span>set_missing_host_key_policy<span class="token punctuation">(</span>paramiko<span class="token punctuation">.</span>AutoAddPolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token comment"># 连接服务器</span>\nssh<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>hostname<span class="token operator">=</span><span class="token string">&quot;192.168.0.99&quot;</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">,</span> username<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&quot;rootroot&quot;</span><span class="token punctuation">)</span>\n<span class="token comment"># 执行命令</span>\nstdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> ssh<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">&#39;df&#39;</span><span class="token punctuation">)</span>\n<span class="token comment"># 获取结果</span>\nresult <span class="token operator">=</span> stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 获取错误提示（stdout、stderr只会输出其中一个）</span>\nerr <span class="token operator">=</span> stderr<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 关闭连接</span>\nssh<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>stdin<span class="token punctuation">,</span> result<span class="token punctuation">,</span> err<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>注：如果注释<code>“ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())”</code>这句，会报错。</p><p>类似问题可以为linux系统中~/.ssh/known_hosts文件中的内容。</p><h3 id="二、实现sftp功能" tabindex="-1"><a class="header-anchor" href="#二、实现sftp功能" aria-hidden="true">#</a> 二、实现SFTP功能</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> paramiko\n<span class="token comment"># 连接虚拟机centos上的ip及端口</span>\ntransport <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>Transport<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.0.99&quot;</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ntransport<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&quot;rootroot&quot;</span><span class="token punctuation">)</span>\n<span class="token comment"># 将实例化的Transport作为参数传入SFTPClient中</span>\nsftp <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SFTPClient<span class="token punctuation">.</span>from_transport<span class="token punctuation">(</span>transport<span class="token punctuation">)</span>\n<span class="token comment"># 将“calculator.py”上传到filelist文件夹中</span>\nsftp<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">&#39;D:\\python库\\Python_shell\\day05\\calculator.py&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/filelist/calculator.py&#39;</span><span class="token punctuation">)</span>\n<span class="token comment"># 将centos中的aaa.txt文件下载到桌面</span>\nsftp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;/filedir/aaa.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">r&#39;C:\\Users\\duany_000\\Desktop\\test_aaa.txt&#39;</span><span class="token punctuation">)</span>\ntransport<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>注：如果遇到Windows中路径问题，链接如下网址http://blog.csdn.net/elang6962/article/details/68068126</p><h3 id="三、使用秘钥实现ssh功能" tabindex="-1"><a class="header-anchor" href="#三、使用秘钥实现ssh功能" aria-hidden="true">#</a> 三、使用秘钥实现SSH功能</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> paramiko\nprivate_key <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>RSAKey<span class="token punctuation">.</span>from_private_key_file<span class="token punctuation">(</span><span class="token string">&#39;id_rsa31&#39;</span><span class="token punctuation">)</span>\n<span class="token comment"># 创建SSH对象</span>\nssh <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SSHClient<span class="token punctuation">(</span><span class="token punctuation">)</span>\nssh<span class="token punctuation">.</span>set_missing_host_key_policy<span class="token punctuation">(</span>paramiko<span class="token punctuation">.</span>AutoAddPolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token comment"># 连接服务器</span>\nssh<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>hostname<span class="token operator">=</span><span class="token string">&#39;192.168.79.9&#39;</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">,</span> username<span class="token operator">=</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span> pkey<span class="token operator">=</span>private_key<span class="token punctuation">)</span>\nstdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> ssh<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">&#39;ifconfig&#39;</span><span class="token punctuation">)</span>\nres_out <span class="token operator">=</span> stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>res_out<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nssh<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="四、使用秘钥实现sftp功能" tabindex="-1"><a class="header-anchor" href="#四、使用秘钥实现sftp功能" aria-hidden="true">#</a> 四、使用秘钥实现SFTP功能</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> paramiko\nprivate_key <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>RSAKey<span class="token punctuation">.</span>from_private_key_file<span class="token punctuation">(</span><span class="token string">&#39;id_rsa31&#39;</span><span class="token punctuation">)</span>\n<span class="token comment"># 连接虚拟机centos上的ip及端口</span>\ntransport <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>Transport<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.79.9&quot;</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ntransport<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> pkey<span class="token operator">=</span>private_key<span class="token punctuation">)</span>\n<span class="token comment"># 将实例化的Transport作为参数传入SFTPClient中</span>\nsftp <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SFTPClient<span class="token punctuation">.</span>from_transport<span class="token punctuation">(</span>transport<span class="token punctuation">)</span>\n<span class="token comment"># 将“calculator.py”上传到filelist文件夹中</span>\nsftp<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">&#39;D:\\python库\\Python_shell\\day05\\calculator.py&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/filedir/calculator.py&#39;</span><span class="token punctuation">)</span>\n<span class="token comment"># 将centos中的aaa.txt文件下载到桌面</span>\nsftp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;/filedir/oldtext.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">r&#39;C:\\Users\\duany_000\\Desktop\\oldtext.txt&#39;</span><span class="token punctuation">)</span>\ntransport<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div>',11),t={render:function(n,s){return p}}}}]);